<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>APlus QR Code Sheet Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- QR code lib (tiny, no build step) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
  <style>
    :root {
      --bg: #0f172a;        /* slate-900 */
      --panel: #111827;     /* gray-900 */
      --muted: #9ca3af;     /* gray-400 */
      --text: #e5e7eb;      /* gray-200 */
      --accent: #22c55e;    /* green-500 */
      --danger: #ef4444;    /* red-500 */
      --card-size: 2.25in;  /* size of QR cards when printing */
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, var(--bg) 0%, #0b1026 100%);
      color: var(--text);
      min-height: 100dvh;
      display: grid;
      grid-template-rows: auto 1fr;
    }
    header {
      padding: 16px clamp(16px, 4vw, 32px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
      position: sticky; top: 0; z-index: 10;
      border-bottom: 1px solid #1f2937;
    }
    header h1 { font-size: clamp(18px, 2.4vw, 22px); margin: 0; letter-spacing: .2px; }
    .btn {
      appearance: none;
      border: 1px solid #1f2937;
      background: #0b122b;
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 0 0 0 rgba(0,0,0,0);
      display: inline-flex; align-items: center; gap: 8px;
    }
    .btn:hover { background: #0d1636; box-shadow: 0 6px 16px rgba(0,0,0,.25);}
    .btn:active { transform: translateY(1px); }
    .btn.accent { border-color: #064e3b; background: #052d1f; color: #a7f3d0; }
    .btn.accent:hover { background: #083524; }
    .btn.danger { border-color: #3f1b1b; background: #2a0f10; color: #fecaca; }
    .btn.small { padding: 6px 10px; border-radius: 8px; font-weight: 600; }

    .wrap {
      padding: clamp(12px, 3.2vw, 28px);
      display: grid;
      gap: 18px;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
    }
    .panel {
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: 16px;
      padding: clamp(12px, 2.6vw, 18px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    form {
      display: grid;
      grid-template-columns: 1fr 2fr auto;
      gap: 12px;
      align-items: end;
    }
    label {
      font-size: 12px; text-transform: uppercase; color: var(--muted);
      letter-spacing: .12em; display:block; margin-bottom: 6px;
    }
    input[type="text"], input[type="url"] {
      width: 100%;
      padding: 12px 12px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #0b122b;
      color: var(--text);
      outline: none;
    }
    input::placeholder { color: #6b7280; }

    .actions { display:flex; gap: 10px; flex-wrap: wrap; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
    }
    .card {
      background: #0b122b;
      border: 1px solid #1f2937;
      border-radius: 14px;
      padding: 12px;
      display: grid;
      gap: 8px;
    }
    .title {
      font-weight: 700;
      line-height: 1.2;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    .url {
      font-size: 12px; color: var(--muted);
      word-break: break-all;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    .qr {
      aspect-ratio: 1 / 1;
      width: 100%;
      background: #000;
      border-radius: 10px;
      display: grid; place-items: center;
      overflow: hidden;
    }
    .qr { background: #fff; padding: 6px; }           /* optional padding for breathing room */
    .qr img, .qr canvas {
     width: 100% !important;  /* override inline width from the library */
     height: auto !important; /* keep aspect ratio */
     display: block;
    }
    
    .card-footer { display: flex; justify-content: space-between; align-items: center; gap: 8px; }

    /* Print styling */
    @media print {
      header, .panel.controls, .card-footer { display: none !important; }
      body { background: #fff; }
      .wrap { padding: 0; max-width: none; }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--card-size), 1fr));
        gap: .25in;
        padding: .25in;
      }
      .card {
        border-radius: 0;
        border: 1px solid #000;
        background: #fff;
        color: #000;
        page-break-inside: avoid;
      }
      .title { color: #000; }
      .url { color: #111; }
      .qr { background: #fff; border: 1px solid #000; }
    }
  </style>
</head>
<body>
  <header>
    <h1>APlus QR Code Sheet Generator</h1>
    <div class="actions">
      <button class="btn" id="exportBtn" title="Export your QR list as JSON (backup)">Export</button>
      <button class="btn" id="importBtn" title="Import from a saved JSON backup">Import</button>
      <button class="btn" id="clearBtn" title="Remove all saved QR entries">Clear</button>
      <button class="btn accent" id="printBtn" title="Open the browser print dialog">Print</button>
    </div>
  </header>

  <main class="wrap">
    <section class="panel controls">
      <form id="qrForm">
        <div>
          <label for="title">Title</label>
          <input id="title" type="text" placeholder="e.g., Portfolio, Menu, Wi-Fi Portal" required />
        </div>
        <div>
          <label for="url">Link (URL)</label>
          <input id="url" type="url" placeholder="https://example.com" required />
        </div>
        <div class="actions">
          <button type="submit" class="btn accent" id="addBtn">Add to List</button>
        </div>
      </form>
    </section>

    <section class="panel">
      <div class="grid" id="cards"></div>
    </section>
  </main>

  <script>
    // --- Utility helpers ---
    const lsKey = "qr_sheet_items_v1";

    function normalizeUrl(u) {
      try {
        // If user typed without protocol, assume https
        if (!/^https?:\/\//i.test(u)) u = "https://" + u;
        const url = new URL(u);
        return url.toString();
      } catch {
        return null;
      }
    }

    function loadItems() {
      try { return JSON.parse(localStorage.getItem(lsKey)) || []; }
      catch { return []; }
    }
    function saveItems(items) {
      localStorage.setItem(lsKey, JSON.stringify(items));
    }

    // --- App state ---
    let items = loadItems(); // [{id, title, url}]

    // --- DOM refs ---
    const form = document.getElementById("qrForm");
    const titleEl = document.getElementById("title");
    const urlEl = document.getElementById("url");
    const cardsEl = document.getElementById("cards");
    const printBtn = document.getElementById("printBtn");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const clearBtn = document.getElementById("clearBtn");

    // --- Render ---
    function render() {
      cardsEl.innerHTML = "";
      if (!items.length) {
        const empty = document.createElement("div");
        empty.style.color = "#9ca3af";
        empty.style.textAlign = "center";
        empty.style.padding = "24px";
        empty.textContent = "No QR codes yet. Add one above!";
        cardsEl.appendChild(empty);
        return;
      }

      for (const item of items) {
        const card = document.createElement("article");
        card.className = "card";
        card.setAttribute("data-id", item.id);

        const h3 = document.createElement("div");
        h3.className = "title";
        h3.textContent = item.title || "(Untitled)";

        const p = document.createElement("div");
        p.className = "url";
        p.textContent = item.url;

        const qrWrap = document.createElement("div");
        qrWrap.className = "qr";
        const qrBox = document.createElement("div");
        qrWrap.appendChild(qrBox);

        // Generate QR
        // eslint-disable-next-line no-undef
        new QRCode(qrBox, {
          text: item.url,
          width: 512,
          height: 512,
          correctLevel: QRCode.CorrectLevel.M, // good balance for print
          colorDark: "#000000",
          colorLight: "#ffffff"
        });

        const footer = document.createElement("div");
        footer.className = "card-footer";

        const small = document.createElement("small");
        small.style.opacity = .7;
        small.textContent = "ID: " + item.id.slice(0, 8);

        const del = document.createElement("button");
        del.className = "btn small danger";
        del.textContent = "Delete";
        del.addEventListener("click", () => {
          items = items.filter(x => x.id !== item.id);
          saveItems(items);
          render();
        });

        footer.appendChild(small);
        footer.appendChild(del);

        card.appendChild(h3);
        card.appendChild(p);
        card.appendChild(qrWrap);
        card.appendChild(footer);

        cardsEl.appendChild(card);
      }
    }

    // --- Events ---
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = (titleEl.value || "").trim();
      const rawUrl = (urlEl.value || "").trim();

      const url = normalizeUrl(rawUrl);
      if (!url) {
        alert("Please enter a valid URL (e.g., https://example.com).");
        urlEl.focus();
        return;
      }

      const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(36).slice(2);

      items.unshift({ id, title, url });
      saveItems(items);
      render();

      form.reset();
      titleEl.focus();
    });

    printBtn.addEventListener("click", () => window.print());

    exportBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(items, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "qr-codes.json";
      a.click();
      URL.revokeObjectURL(a.href);
    });

    importBtn.addEventListener("click", async () => {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = async () => {
        const file = input.files?.[0];
        if (!file) return;
        try {
          const text = await file.text();
          const parsed = JSON.parse(text);
          if (!Array.isArray(parsed)) throw new Error("Bad format");
          // Basic sanity map
          const cleaned = parsed
            .map(x => ({ id: x.id || String(Date.now())+Math.random(), title: x.title || "", url: normalizeUrl(x.url) }))
            .filter(x => x.url);
          items = cleaned.concat(items); // prepend imported
          saveItems(items);
          render();
        } catch (err) {
          alert("Import failed. Make sure it's a JSON export from this tool.");
          console.error(err);
        }
      };
      input.click();
    });

    clearBtn.addEventListener("click", () => {
      if (confirm("Delete ALL saved QR codes? This cannot be undone.")) {
        items = [];
        saveItems(items);
        render();
      }
    });

    // Initial paint
    render();
  </script>
</body>
</html>
